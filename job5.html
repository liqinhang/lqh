<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç”µå•†åœ¨çº¿è®¢å•ç³»ç»Ÿ - Job5</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .box { border: 1px solid #ddd; padding: 15px; margin: 15px 0; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .clock { font-size: 20px; font-weight: bold; color: #336699; margin-bottom: 10px; }
        label { display: inline-block; width: 120px; font-weight: bold; margin-bottom: 10px; }
        input[type="text"], select { padding: 5px; width: 200px; margin-bottom: 10px; }
        button { padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: center; font-size: 14px; }
        th { background-color: #f8f9fa; }
        h1, h2, h3 { color: #333; }
        .highlight-red { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <script>
        document.write("<h1>ç”µå•† Â· è¿è¥åå° Â· è®¢å•å½•å…¥ä¸é”€å”®çœ‹æ¿</h1>");
        document.write("<p>æ¬¢è¿ä½¿ç”¨å†…éƒ¨å·¥å…·ï¼Œå®æ—¶æŸ¥çœ‹è®¢å•ä¸é”€å”®æƒ…å†µã€‚</p>");

        // å…¨å±€ä¼˜æƒ æç¤º banner
        document.write(`
        <div style="padding:12px; background:#eef9ff; border-left:5px solid #3aa0e6; margin:10px 0; font-size:14px;">
            <strong>ğŸ’¡ æ¸©é¦¨æç¤ºï¼šæœ¬åº—å½“å‰å¯äº«å—çš„ä¼˜æƒ ä¸åŠ ä»·æ”¿ç­–å¦‚ä¸‹ï¼š</strong>
            <ul style="margin:8px 0 0 20px; line-height:1.6;">
                <li>ğŸ‰ <strong>VIP å®¢æˆ·</strong> äº«å— <strong>9 æŠ˜</strong>ä¼˜æƒ </li>
                <li>âš¡ <strong>åŠ æ€¥å‘è´§</strong> ä»·æ ¼ä¼š <strong>x1.1</strong></li>
                <li>â° <strong>æ¯å°æ—¶å‰ 10 åˆ†é’Ÿ</strong> ä¸‹å•å†äº« <strong>8.5 æŠ˜</strong></li>
                <li>ğŸ“¦ <strong>[æ™®é€šå®¢æˆ·ç¦åˆ©]</strong> éVIPä¸”è´­ä¹°æ•°é‡ > 3ä»¶ï¼Œé¢å¤–å†æ‰“ <strong>9 æŠ˜</strong></li>
            </ul>
        </div>
        `);
        
        // åŠ¨æ€æ—¶é—´ Banner é€»è¾‘
        var nowForBanner = new Date();
        var minuteForBanner = nowForBanner.getMinutes();
        
        if (minuteForBanner >= 0 && minuteForBanner <= 9) {
            document.write(`
            <div style="padding:12px; background:#fffbe6; border-left:5px solid #f4d06f; margin:10px 0;">
                 â³ å½“å‰ä¸ºå‰ 10 åˆ†é’Ÿï¼æœ¬å•å¯é¢å¤–äº«å— <strong>8.5 æŠ˜</strong> æ—¶æ®µä¼˜æƒ ï¼
            </div>
            `);
        } else {
             document.write(`
            <div style="padding:12px; background:#f5f5f5; border-left:5px solid #ccc; margin:10px 0; color:#666;">
                 ğŸ•’ å°è´´å£«ï¼šæ¯ä¸ªæ•´ç‚¹å‰ 10 åˆ†é’Ÿäº«å— 8.5 æŠ˜ä¼˜æƒ ï¼Œè¯·ç•™æ„ä¸‹å•æ—¶é—´~
            </div>
            `);
        }
    </script>

    <div id="clock" class="clock">æ­£åœ¨åŠ è½½æ—¶é—´...</div>

    <div class="box">
        <h2>æ–°å»ºè®¢å•</h2>
        <div>
            <label>å®¢æˆ·åç§°ï¼š</label>
            <input type="text" id="customerName" placeholder="è¯·è¾“å…¥å®¢æˆ·å§“å">
        </div>
        <div>
            <label>å•†å“å•ä»· (Â¥)ï¼š</label>
            <input type="text" id="priceInput" placeholder="è¯·è¾“å…¥æ•°å­—">
        </div>
        <div>
            <label>æ•°é‡ (ä»¶)ï¼š</label>
            <input type="text" id="qtyInput" placeholder="è¯·è¾“å…¥æ•´æ•°">
        </div>
        <div>
            <label>å®¢æˆ·ç±»å‹ï¼š</label>
            <select id="customerType">
                <option value="normal">æ™®é€šå®¢æˆ·</option>
                <option value="vip">VIP å®¢æˆ·</option>
            </select>
        </div>
        <div>
            <label>åŠ æ€¥å‘è´§ï¼š</label>
            <input type="checkbox" id="urgentFlag" style="width:auto;"> æ˜¯
        </div>
        <div style="margin-top:15px;">
            <button onclick="validateForm()">æ·»åŠ è®¢å•</button>
        </div>
    </div>

    <div id="orderResult" class="box" style="background-color: #fafafa;">
        <p style="color:#999;">æš‚æ— æ–°å½•å…¥è®¢å•...</p>
    </div>

    <div class="box">
        <h2>ğŸ“Š é”€å”®å†å²çœ‹æ¿</h2>
        <div id="dashboard" style="font-weight:bold; color:#333; margin-bottom:10px;">
            <p>è®¢å•æ•°ï¼š0</p>
            <p>é”€å”®æ€»é¢ï¼šÂ¥ 0.00</p>
            <p>å¹³å‡å®¢å•ä»·ï¼šÂ¥ 0.00</p>
        </div>
        <div id="orderTable">
            </div>
    </div>

    <script>
        // å­˜å‚¨æ‰€æœ‰è®¢å•çš„æ•°ç»„
        var orders = [];

        // è¾…åŠ©å‡½æ•°ï¼šè¡¥é›¶
        function padZero(n) {
            return n < 10 ? "0" + n : n;
        }

        // æ—¶é’ŸåŠŸèƒ½
        function updateClock() {
            var now = new Date();
            var y = now.getFullYear();
            var m = now.getMonth() + 1;
            var d = now.getDate();
            var hh = now.getHours();
            var mm = now.getMinutes();
            var ss = now.getSeconds();
            var weekNames = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];
            var w = weekNames[now.getDay()];

            var timeStr = y + "å¹´" + padZero(m) + "æœˆ" + padZero(d) + "æ—¥ æ˜ŸæœŸ" + w + " " + 
                          padZero(hh) + ":" + padZero(mm) + ":" + padZero(ss);
            
            document.getElementById("clock").innerHTML = timeStr;
        }
        
        // å¯åŠ¨æ—¶é’Ÿ
        updateClock();
        setInterval(updateClock, 1000);

        // è¡¨å•æ ¡éªŒå‡½æ•°
        function validateForm() {
            var nameStr = document.getElementById("customerName").value;
            var priceStr = document.getElementById("priceInput").value;
            var qtyStr = document.getElementById("qtyInput").value;
            var typeStr = document.getElementById("customerType").value;
            var urgentChecked = document.getElementById("urgentFlag").checked;

            var valid = true;

            // 1. æ ¡éªŒå§“å
            if (nameStr == null || nameStr.trim() === "") {
                alert("å®¢æˆ·åç§°ä¸èƒ½ä¸ºç©ºï¼");
                valid = false;
            }

            // 2. æ ¡éªŒä»·æ ¼
            var price = parseFloat(priceStr);
            if (isNaN(price) || price <= 0) {
                alert("å•†å“å•ä»·å¿…é¡»æ˜¯å¤§äº 0 çš„æ•°å­—ï¼");
                valid = false;
            }

            // 3. æ ¡éªŒæ•°é‡
            var qty = parseInt(qtyStr, 10);
            if (isNaN(qty) || qty <= 0) {
                alert("æ•°é‡å¿…é¡»æ˜¯å¤§äº 0 çš„æ•´æ•°ï¼");
                valid = false;
            }

            // æ ¡éªŒå¤±è´¥åˆ™åœæ­¢
            if (!valid) {
                document.getElementById("orderResult").innerHTML = "<p style='color:red'>x è®¢å•å½•å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥ã€‚</p>";
                return false;
            }

            // æ ¡éªŒé€šè¿‡ï¼Œè°ƒç”¨å¤„ç†å‡½æ•° 
            processOrder(nameStr.trim(), price, qty, typeStr === "vip", urgentChecked);
        }

        // æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å‡½æ•°
        function processOrder(customerName, price, quantity, isVip, isUrgent) {
            // åŸºç¡€æ€»ä»·
            var baseTotal = price * quantity;

            // VIP æŠ˜æ‰£
            var afterVip = isVip ? baseTotal * 0.9 : baseTotal;

            // åŠ æ€¥è´¹
            var afterUrgent = isUrgent ? afterVip * 1.1 : afterVip;

            // æ—¶é—´æŠ˜æ‰£ (æ¯å°æ—¶å‰10åˆ†é’Ÿ)
            var now = new Date();
            var minute = now.getMinutes();
            var hitTimeDiscount = false;
            var finalTotal = afterUrgent;

            if (minute >= 0 && minute <= 9) {
                finalTotal *= 0.85;
                hitTimeDiscount = true;
            }

            // ============================================================
            // ã€å­¦å·æœ«ä½ 2 å®šåˆ¶é€»è¾‘ã€‘ 
            // æ¡ä»¶ï¼šå®¢æˆ·æ˜¯æ™®é€šå®¢æˆ·ï¼ˆ!isVipï¼‰ä¸” è´­ä¹°æ•°é‡ > 3 (quantity > 3)
            // æ•ˆæœï¼šåœ¨é€šç”¨æŠ˜æ‰£ä¹‹åï¼Œå¯¹è®¢å•é‡‘é¢å†æ‰“ 9 æŠ˜
            // ============================================================
            var hitBulkDiscount = false; // ç”¨äºç•Œé¢æ˜¾ç¤ºçš„æ ‡è®°
            if (!isVip && quantity > 3) {
                finalTotal = finalTotal * 0.9;
                hitBulkDiscount = true; 
            }
            // ============================================================

            // åˆ¤æ–­æ˜¯å¦ä¸ºå¤§é¢è®¢å•ï¼ˆä¸ºäº†æ˜¾ç¤ºæ•ˆæœï¼‰
            var isImportant = isVip && finalTotal > 1000;

            // æ„å»ºä¼˜æƒ è¯¦æƒ…åˆ—è¡¨
            var tipsHtml = "<ul>";
            tipsHtml += isVip ? "<li>VIP 9æŠ˜å·²åº”ç”¨</li>" : "<li>æ™®é€šå®¢æˆ·æ—  VIP ä¼˜æƒ </li>";
            tipsHtml += isUrgent ? "<li>åŠ æ€¥ x1.1 å·²åº”ç”¨</li>" : "<li>æœªåŠ æ€¥</li>";
            tipsHtml += hitTimeDiscount ? "<li><span class='highlight-red'>å‘½ä¸­å‰ååˆ†é’Ÿ x0.85</span></li>" : "<li>æ— æ—¶æ®µæŠ˜æ‰£</li>";
            
            // æ˜¾ç¤ºå­¦å·2çš„ç‰¹æ®ŠæŠ˜æ‰£ä¿¡æ¯
            if (hitBulkDiscount) {
                tipsHtml += "<li><span class='highlight-red'>[æ™®é€šå®¢æˆ·ç¦åˆ©] æ•°é‡>3 å†æ‰“9æŠ˜ï¼</span></li>";
            }
            tipsHtml += "</ul>";

            // è¾“å‡ºå•æ¡ç»“æœåˆ°é¡µé¢
            document.getElementById("orderResult").innerHTML = 
                "<h3>âœ… è®¢å•å½•å…¥æˆåŠŸï¼š</h3>" +
                "<p><strong>å®¢æˆ·åç§°ï¼š</strong>" + customerName + "</p>" +
                "<p>åŸºç¡€é‡‘é¢ï¼šÂ¥" + baseTotal.toFixed(2) + "</p>" +
                "<p>VIPåï¼šÂ¥" + afterVip.toFixed(2) + "</p>" +
                "<p>åŠ æ€¥åï¼šÂ¥" + afterUrgent.toFixed(2) + "</p>" +
                "<p style='font-size:18px; font-weight:bold; color:red;'>æœ€ç»ˆé‡‘é¢ï¼šÂ¥" + finalTotal.toFixed(2) + "</p>" +
                "<div style='background:#eef; padding:8px; border-radius:4px;'>ä¼˜æƒ è¯¦æƒ…ï¼š" + tipsHtml + "</div>";

            // å°†æ•°æ®æ¨å…¥æ•°ç»„
            orders.push({
                name: customerName,
                price: price,
                qty: quantity,
                baseTotal: baseTotal,
                finalTotal: finalTotal,
                isVip: isVip,
                isUrgent: isUrgent,
                hitTimeDiscount: hitTimeDiscount,
                hitBulkDiscount: hitBulkDiscount // è®°å½•æ˜¯å¦è§¦å‘äº†ç‰¹æ®Šè§„åˆ™
            });

            // æ›´æ–°å†å²çœ‹æ¿
            renderDashboard();
        }

        // æ¸²æŸ“å†å²çœ‹æ¿è¡¨æ ¼
        function renderDashboard() {
            var count = orders.length;
            var totalSales = 0;

            // å¾ªç¯ç´¯åŠ 
            for (var i = 0; i < orders.length; i++) {
                totalSales += orders[i].finalTotal;
            }

            var avg = count > 0 ? totalSales / count : 0;

            // æ›´æ–°ç»Ÿè®¡æ–‡å­—
            document.getElementById("dashboard").innerHTML = 
                "<p>è®¢å•æ•°ï¼š" + count + "</p>" +
                "<p>é”€å”®æ€»é¢ï¼šÂ¥ " + totalSales.toFixed(2) + "</p>" +
                "<p>å¹³å‡å®¢å•ä»·ï¼šÂ¥ " + avg.toFixed(2) + "</p>";

            // ç”Ÿæˆè¡¨æ ¼ HTML
            var tableHtml = "<table><tr>" +
                "<th>å®¢æˆ·åç§°</th><th>å•ä»·</th><th>æ•°é‡</th><th>åŸºç¡€é‡‘é¢</th><th>æœ€ç»ˆé‡‘é¢</th><th>VIP</th><th>åŠ æ€¥</th><th>æ—¶æ®µä¼˜</th><th>é‡å¤§ä¼˜(ID:2)</th>" +
                "</tr>";

            for (var j = 0; j < orders.length; j++) {
                var o = orders[j];
                tableHtml += "<tr>" +
                    "<td>" + o.name + "</td>" +
                    "<td>" + o.price.toFixed(2) + "</td>" +
                    "<td>" + o.qty + "</td>" +
                    "<td>" + o.baseTotal.toFixed(2) + "</td>" +
                    "<td><strong>" + o.finalTotal.toFixed(2) + "</strong></td>" +
                    "<td>" + (o.isVip ? "æ˜¯" : "å¦") + "</td>" +
                    "<td>" + (o.isUrgent ? "æ˜¯" : "å¦") + "</td>" +
                    "<td>" + (o.hitTimeDiscount ? "æ˜¯" : "å¦") + "</td>" +
                    // å¢åŠ ä¸€åˆ—æ˜¾ç¤ºæ˜¯å¦è§¦å‘äº†å­¦å·2çš„è§„åˆ™
                    "<td>" + (o.hitBulkDiscount ? "æ˜¯" : "-") + "</td>" +
                    "</tr>";
            }

            tableHtml += "</table>";
            document.getElementById("orderTable").innerHTML = tableHtml;
        }
    </script>
</body>
</html>